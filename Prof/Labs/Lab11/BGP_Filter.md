#  BGP Управление анонсами.

###  Задание:

BGP. Фильтрация
Цель: 

Настроить фильтрацию для офисе Москва

Настроить фильтрацию для офисе С.-Петербург


1. Настроить фильтрацию в офисе Москва так, чтобы не появилось транзитного трафика(As-path)
2. Настроить фильтрацию в офисе С.-Петербург так, чтобы не появилось транзитного трафика(Prefix-list)
3. Настроить провайдера Киторн так, чтобы в офис Москва отдавался только маршрут по-умолчанию
4. Настроить провайдера Ламас так, чтобы в офис Москва отдавался только маршрут по-умолчанию и префикс офиса С.-Петербург

![image](https://github.com/user-attachments/assets/aaff4950-7c72-4164-9306-b1493484da22)

## Предварительная подготовка

1.	Вводим PI адреса в AS1001 (Москва) 100.100.20.0 /24
	
2.	Вводим PI адреса в AS2042 (Питер) 200.200.30.0 /24

3.	Привязываем эти прификсы на интерфейс Null 0 
	 
	   
	   ip route 100.100.20.0 255.255.255.0 Null 0 на роутерах R14 и R15 Москва 
	   
	   ip route 200.200.30.0 255.255.255.0 Null 0 на R18 C.-Петербуррг соответственно
	   
4.	Анонсируем адресное пространство PI адресов в Москве на обоих роутерах R14 и R15:

  router bgp 1001
  network 100.100.20.0 mask 255.255.255.0
	
6.	Создаем LoopBack интерфейсы на роутерах R14, R15 и R18. 

        R14 IP 100.100.20.14 /32
        R15 IP 100.100.20.15 /32 
        R18 IP 200.200.30.18 /32
  	
8.	Анонсируем сети по BGP 100.100.20.14 /32 на R14 и 100.100.20.15 /32 на R15 для того, чтобы роутеры в Москве знали, как добраться до данных сетей по iBGP
	
9.	Создадим еще одно eBGP соседство между Киторн и Триада. Роутеры R22 и R23.  Это необходимо сделать в случае отказа канала между Ламас и Триада

Eсли откажет линк между Киторном и Триадой или Киторном и Ламасом , то Москва будет "транзитом" /Для предотврашения такой ситуации на роутере R14 создадим

     ip as-path access-list 1 permit ^$
     ip as-path access-list 1 deny .*

Добавим as-path лист к соседу Киторн R22

     router bgp 1001
     neighbor 50.50.50.1 filter-list 1 out

![image](https://github.com/user-attachments/assets/90df6fcd-3ca7-4ae5-8535-01aae7d8d657)

после применения path листа маршрут через Москву 50.50.50.2 пропал, а роутер R14 стал отдавать только свои анонсированные сети.

## 2. Настроить фильтрацию в офисе С.-Петербург так, чтобы не появилось транзитного трафика(Prefix-list)

До применения фильтрации на R18 префиксы которые он отдает соседям Триады видны на скриншоте. А это значит, что роутер R18 является транзитным

![image](https://github.com/user-attachments/assets/21e96936-f407-46a7-b76d-66a38a7e63f9)

На R18 согласно задания созадим prefix-list.

     ip prefix-list AS2042 seq 5 permit 200.200.30.0/24
     
Далее создадим route-map и будем проверять соответствие адреса из prefix-list созданного ранее

     route-map AS2042 permit 10
     match ip address prefix-list AS2042
     
Повесим route-map на двух соседей Триады
     
     neighbor 100.100.100.1 route-map AS2042 out
     neighbor 110.110.110.1 route-map AS2042 out
     
Из скриншота видно, что R18 отдает соседям только свой префикс PI адресов

![image](https://github.com/user-attachments/assets/a73d6636-3de9-4c32-83f4-0cd1a6a5306d)

## 3. Настроить провайдера Киторн так, чтобы в офис Москва отдавался только маршрут по-умолчанию

Необходимо на роутере R22 Киторн смотрящим на соседа Москва 50.50.50.2 выполнить команду:
    
       neighbor 50.50.50.2 default-originate 
 
 Так же на R22 создать prefix-list запрещающий отдавать префиксы Триады и Питера. В BGP привязать prefix-list на соседа R14 50.50.50.2.
 
      ip prefix-list DENY deny 0.0.0.0/0
      router bgp 101
      neighbor 50.50.50.2 prefix-list DENY out
       
 Таблица R14 до применения команды
 
![image](https://github.com/user-attachments/assets/13e82b0f-0a7a-4434-b7ac-555442a2caa3)

  
 Таблица R14 после применения команды. Маршрут по умолчанию приходит от R22 Киторн

![image](https://github.com/user-attachments/assets/72d9dccc-b70f-4ea7-a810-2325c0bdcbe7)


## 4. Настроить провайдера Ламас так, чтобы в офис Москва отдавался только маршрут по-умолчанию и префикс офиса С.-Петербург

Необходимо на R21 ввести команду

     neighbor 60.60.60.2 default-originate 
     
Так же на R21 создать prefix-list с сетью С.-Петербурга и в BGP привяязать prefix-list на R15 60.60.60.2. 

     ip prefix-list 1 permit 200.200.30.0/24 - создаем prefix-list
     router bgp 301
     neighbor 60.60.60.2 prefix-list 1 out
 
 Таблица маршрутизации до применения настроек

![image](https://github.com/user-attachments/assets/f7c0e972-ddbb-416b-8d2b-2b4a7275ced8)
   
 Видно, что приходят префиксы от Петербурга и от Триады.  
 
 
 Таблица маршрутизации после применения настроек
 
![image](https://github.com/user-attachments/assets/a0d1da87-6bdc-4bab-8ab9-f0d13fbdd20c)


