Сеть иаршрутизаторов RT настроена в отдельую AS 101. Обмен данными между маршрутизаторами через Loopback интерфейсы и ISIS.

Сети остальных провайдеров обмениваются маршрутами через через iBGP.

конфигурации всех устройств можно посмотреть [в разделе Config&Result/CONFIGS/](https://github.com/DowningSun/OTUS/tree/main/Prof/Labs/FINAL/Config%26Result/CONFIGS)



В результате доработок карте сетей приобрела следующий вид.

![image](https://github.com/user-attachments/assets/a6208663-4d1e-48fd-88d3-ce351e3d420b)

Был добавлен узел YANDEX_PING_CHEK с адресом 77.88.8.8 для проверки состояния соеединения через интернет, коммутатор VPN_SUMM (работает в режиме L2) в зоне "Головной офис", на котором сходятся линки провайдлерских VPN был добавлен для объединения линком двух разных провайдеров.

В сети "Село Ближнее" был добавлен линк от провайдера RT.

От сети "Посёлок дальний" в "Головной офис" добавился L2VPN канал от провайдера RT.

На всех маршрутизаторах организован NAT(PAT), написаны правила, исключающие VPN трафик из NAT. Поскольку HQ_CORE является узлом VPN, то на R1HQ и R2HQ организован NAT-T.

![INTERNET_CHEK_MAIN](https://github.com/user-attachments/assets/6c57eee5-3a28-466f-ba83-40951dc46b78)

Переключение приоритетных провайдеров и VPN происходит с помощью IP SLA

![image](https://github.com/user-attachments/assets/e4c29cce-a0aa-4cea-b61a-92cca315e817)

В связке R1HQ-R2HQ-HQ-CORE организована маршрутизация с помощью BGP для передачи маршрутов от роутеров во внутреннюю сеть.

Для обеспечения связаности "Поселок Дальний" и "Село ближнее" по каналам провайдеров было принято решение поставить коммутатор VPN_SUMM, рабочтающий в режиме L2, что позволяет настроить взаимодействие между всеми тремя объектами в обход общего интернета.

В этой сети поднят Site-To-Site VPN с IPSec для шифрования передаваемого трафика. Данный канал используется как основной. В реальной схеме, на которую я опирался при разработке данной схемы, это позволяет получить более низний и стабильный пинг между узлами (в реальности трафик через интернет между R1HQ и R1F1 идёт через остатки GOLDEN-TELECOM-MSK со средним врременем отклика в 40+ мс, против 2-4 мс по L2VPN. Подобная ситуация и при связи R1F2 с H1HQ)

![VPN_CHEK_L2](https://github.com/user-attachments/assets/84194a1c-18ac-4d15-8da0-2729c238b02a)

В случае недоступности узлов происходит переключение на резервные VPN каналы. Для связи с Головным офисом используется GRE с IPSec, F1 и F2 используют Site-to-SIte.

![VPN_CHEK_RES1](https://github.com/user-attachments/assets/3153671c-c6b9-417e-b185-9e76baca761b)

![VPN_CHEK_RES2](https://github.com/user-attachments/assets/b85ac38b-9284-4d8d-9e5b-f3bf48ec730b)

Таким образом реализованы требования, поставленные при разработке плана по модернизации сети.

# Что есть в реальности, но не было реализовано в схеме.

1) Сокращено количество VPN маршрутов. В реальности каждый узел имеет связь с со всеми соседними узлами. 
На примере Головного офиса это реализовано как: Основной маршрут через L2VPN провадера, Резерв1: от R1HQ к основному провайдеру  филиала, от R1HQ к резервному провайдеру филиала, От R2HQ к основному провайдеру филиала, от R2HQ к резервному провайдеру.
Т.е. связь головного офиса с филиалом резервируется 4 каналами, вместо 2х, показанных в моей ссхеме. Я посчитал ненужным плодить код, отличающийся на пару цифр.

2) ACL. В моей схеме реализованы ACL, позволяющие доступ по принципу "все ко всем".

В реальности есть большой список расширенных и рефлексивных ACl, которые настраивают строгое взаимодействие как между VLAN в рамках одного филиала, так и взаимодействе между филиалами./

Данных условностей я считаю достаточными, чтобы реализовать принципиальную схему работы, соответствующую поставленным задачам.


