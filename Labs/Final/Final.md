### Итоговая работа

**Тема: Модификация существующей одноранговой сети офиса**


**Топология**

![image](https://github.com/DowningSun/OTUS/assets/156109695/78990946-01ea-403d-b82f-e6ab1758c642)


**Таблица адресации:**

| Устройство | Интерфейс | IP-адрес | Маска подсети | Шлюз по умолчанию |
| ------ | ------ | ------ | ------ | ------ |
| CORE | SVI VLAN 10 | 10.10.1.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 10 | 11.11.11.4 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 20 | 10.10.2.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 30 | 10.10.3.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 40 | 10.10.4.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 50 | 10.10.5.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 60 | 10.10.6.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 70 | 10.10.7.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 80 | 10.10.8.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 90 | 10.10.9.254 | 255.255.255.0 | ------ |
| CORE | SVI VLAN 192 | 192.168.10.254 | 255.255.255.0 | ------ |
| SW2 | SVI VLAN 80 | 10.10.8.2 | 255.255.255.0 | ------ |
| SW3 | SVI VLAN 80 | 10.10.8.3 | 255.255.255.0 | ------ |
| SW4 | SVI VLAN 80 | 10.10.8.4 | 255.255.255.0 | ------ |
| SW5 | SVI VLAN 80 | 10.10.8.5 | 255.255.255.0 | ------ |
| SW6 | SVI VLAN 80 | 10.10.8.6 | 255.255.255.0 | ------ |
| SW7 | SVI VLAN 80 | 10.10.8.7 | 255.255.255.0 | ------ |
| SW8 | SVI VLAN 80 | 10.10.8.8 | 255.255.255.0 | ------ |
| SW9 | SVI VLAN 80 | 10.10.8.9 | 255.255.255.0 | ------ |
| SW10 | SVI VLAN 80 | 10.10.8.10 | 255.255.255.0 | ------ |
| SW11 | SVI VLAN 80 | 10.10.8.11 | 255.255.255.0 | ------ |
| SW12 | SVI VLAN 80 | 10.10.8.12 | 255.255.255.0 | ------ |
| PROV_master | G0/0/1 | 11.11.11.1 | 255.255.255.240 | ------ |
| PROV_master | G0/0/0 | 43.136.61.142 | 255.255.255.0 | ------ |
| PROV_slave | G0/0/1 | 11.11.11.2 | 255.255.255.240 | ------ |
| PROV_slave | G0/0/0 | 80.82.131.6 | 255.255.255.0 | ------ |
| PROV_master | HSRP | 11.11.11.3 | 255.255.255.0 | ------ |
| PROVaider1 | G0/0/0 | 8.7.6.5 | 255.0.0.0 | ------ |
| PROVaider1 | G0/0/1 | 192.168.168.168 | 255.255.255.0 | ------ |
| PROVaider1 | G0/0/2 | 43.136.61.25 | 255.255.255.0 | ------ |
| PROVaider2 | G0/0/0 | 80.82.131.7 | 255.255.255.0 | ------ |
| PROVaider2 | G0/0/1 | 192.168.168.1 | 255.255.255.0 | ------ |
| INTERNET | NIC | 8.8.8.8 | 255.0.0.0 | 8.7.6.5 |
| PC6 | NIC | 10.10.9.1 | 255.255.255.0 | 10.10.9.254 |
| PC7 | NIC | 10.10.9.2 | 255.255.255.0 | 10.10.9.254 |
| PC8 | NIC | 10.10.9.3 | 255.255.255.0 | 10.10.9.254 |
| DHCP/DNS | NIC | 192.168.10.253 | 255.255.255.0 | 192.168.10.254 |
| 1C-ka | NIC | 192.168.10.239 | 255.255.255.0 | 192.168.10.254 |
| FILESHARE | NIC | 192.168.10.250 | 255.255.255.0 | 192.168.10.254 |
| ATC | Fa0/0 | 10.10.7.248 | 255.255.255.0 | 10.10.7.254 | 
| ALL PC | Nic | DHCP | | |
| ALL PRINTERS | NIC | DHCP | | |
| ALL PHONES | SVI VLAN 70 | DHCP | | | 

### Таблица VLAN

| VLAN | ИМЯ | Назначеный интерфейс |
| ------ | ------ | ------ |
| VLAN 10 | SALES | SW4: Fa0/2-4; SW5: Fa0/1-3; SW6: Fa0/1-3 |
| VLAN 11 | Vlan11 | CORE: Fa0/11, Fa0/13 |
| VLAN 20 | OPERATORS | SW7: Fa0/1-3; SW8: Fa0/1-3 |
| VLAN 30 | WH | SW 11: F0/5 |
| VLAN 40 | PRINTERS | SW4: Fa 0/1; SW5: Fa0/4; SW6: Fa 0/4; SW7: Fa0/4; SW9: Fa0/3 |
| VLAN 50 | OTHER | SW9: Fa0/1-2 |
| VLAN 60 | DMZ | SW 4: Fa0/5-9, Fa0/11-24, G0/1-2; SW5: Fa0/5-10, Fa0/12-24, G0/1-2; SW6: Fa0/5-11, Fa0/13/24, G0/1-2; SW7: Fa0/5-12, Fa0/14-24, G0/1-2; SW8: Fa0/4-13, Fa0/15-24, G0/1-2; SW9: Fa0/4-9, Fa0/11-24, G0/1-2; SW10: Fa0/4-10, F0/11-24, G0/2; SW11: Fa0/1-4, F0/6-24; G0/1; SW12: Fa0/5-24; SW2: Fa0/1-2, Fa0/5-9; Fa0/12-21; SW3: Fa0/3-9, Fa0/15-21, G0/1-2; CORE: Fa0/5-10, Fa0/12, Fa0/14-24, G0/1-2 |
| VLAN 70 | ATC | SW4: Fa0/2-4; SW5: Fa0/1-3; SW6: Fa0/1-3; SW7: Fa0/1-3; SW8: Fa0/1-3; SW 11: F0/5, SW12: F0/4 |
| VLAN 80 | MGMNT | No ACCES ports |
| VLAN 90 | ADMIN | SW10: Fa0/1-3 |
| VLAN 100 | DEFAULT_VLAN | No ACCES ports |
| VLAN 192 | SERVERS | SW12: Fa0/1-3 | 


**Описание работы:**

Данная проектная работа основана на реальном заказе по модификации ЛВС офиса, занимающего 2 этажа в здании 1 и прилегающее складское строение. На топологической схеме складское здание - это сегмент WARHOUSE.
Изначально в ЛВС заказчика отсутствовал DHCP сервер, все элементы были настроены на статические адреса. Это было связано с тем, что имелось 3 LAN (Lan1 для компьютеров, Lan2 для принтеров и Lan3 для телефонов). Сумарное количество устройств превышало 254, а обслуживающий специалист не имел достаточной квалификации для настройки сегментов большей вместимости.
По входящему ТЗ должно существовать несколько сегментов сети (VLAN) соответствующих отделам (SALES, OPERATORS, WH, OTHER, ADMIN), отдельные VLAN для устройств (ATC, PRINTERS, SERVERS), и сеть DMZ, доступ в которую должны иметь все вышеназванные сегменты, но доступ ИЗ которой возможен только в интернет.
Обмен трафиком между VLAN SALES, OPERATORS, WH, OTHER разрешен только для ECHO, VLAN ADMIN имеет полный доступ ко всем элементам сети. Доступ к сегменту SERVERS возможен только по ограниченому списку адресов и портов (3389 для RDP, 1560-1591 для работы тонких клиентов 1С, 137-139 и 145 для работы SMB протокола, а также FTP).
Также было предявлено требование к отказоустойчивости доступа в сеть интернет, которое будет реализовано с помощью подключения второго провайдера, и создания настройки маршрутизации между устройстваи доступа к сети провайдера 1 и провайдера 2.

**Настройки управляющего коммутатора** 

За маршрутизацию между VLAN отвечает L3 коммутатор CORE.

Для этого на нем необходимо включить маршрутизацию с помощью команды IP ROUTING

![image](https://github.com/DowningSun/OTUS/assets/156109695/166688e9-47b2-4f5e-a73c-c40a20ff4466)

А также прописать все VLAN 

![image](https://github.com/DowningSun/OTUS/assets/156109695/58b909ac-1f6d-4d05-8f1a-c27eedd687c6)

И назначить соответствующим VLAN адреса, т.к. в будущем эти адреса будут адресом щлюза по умолчанию длля соответствующим VLAN

![image](https://github.com/DowningSun/OTUS/assets/156109695/bb8cf63f-4ddc-4632-94cc-46242628ca60)

Порты, ведущие к коммутаторам распределения переводятся в режим агрегации с помощью протокола LACP для увеличения пропускной способности и дублирования физического канала.

![image](https://github.com/DowningSun/OTUS/assets/156109695/aeb1f59c-2a6b-480a-b3dc-172598cd6223) 

В качестве шшлюза по умолчанию для коммутатора CORE используется 11.11.11.3

![image](https://github.com/DowningSun/OTUS/assets/156109695/9e08d1a6-3332-4800-9a97-82128ed16fc5)

Протокол STP включен по умолчанию в режиме PVST. Было принято решение не менять его во избежании путаницы, т.к. сеть планируется мультивендорная.

![image](https://github.com/DowningSun/OTUS/assets/156109695/e1cb6c90-39fc-4bcb-8fb2-78a3f6b47264)

Интерфейсы PO1 и PO2 включены в режиме транка для всех VLAN. Особенность L3 коммутатора в том, что при включении транка также надо включать инкапсулюцию dot1Q

![image](https://github.com/DowningSun/OTUS/assets/156109695/8a24bb3c-1e2d-4b23-a5b5-33e5484d15f0)


**Настройки коммутаторов распределения**

Для распределения трафика используются коммутаторы SW2 и SW3

На коммутаторе SW2 запущена агрегация каналов PO2, идущий к управляющему коммутатору CORE, PO4 идущий к коммутатору доступа к серверам, PO5 идущий к коммутатору SW3, использующийся как резервный канал на случай обрыва связи между CORE и SW3.

![image](https://github.com/DowningSun/OTUS/assets/156109695/f671501a-6823-431e-8cbf-48e0585f17dc)

Интерфейсы PO2; PO4; PO5 являются транковыми для всех VLAN, STP включен по умолчанию.

![image](https://github.com/DowningSun/OTUS/assets/156109695/7bac095f-1471-447d-b767-775598d32c6c)

Коммутатор SW 3 имеет агрегацию в направлении коммутатора CORE и SW2 соответственно.  Агрегированные порты являются транками для всех VLAN. STP включен по умолчанию.

![image](https://github.com/DowningSun/OTUS/assets/156109695/1fe2cfdd-71e1-452c-aa8f-de6c1613ccf9)
![image](https://github.com/DowningSun/OTUS/assets/156109695/a6c7eb1d-921a-4226-b233-9b1cd7da72f6)

Коммутаторы SW2 и SW3 соответствуют поэтажной разводке ЛВС.

**Настройки коммутаторов доступа**

На всех коммутатораъ доступа (SW4-SW12) порты, не являющиеся транковыми имеют настройку spanning-tree portfast disable.

Порты,  к которым подключены IP-телефоны имеют двойную настройку: ACCES VLAN и VOICE VLAN для передачи соответствующего VLAN и для передачи VOICE VLAN. В реальности же данные порты будут в режиме TRUNK из-за специфики промежуточных телефонных аппараторв, которые принимают трафик по TRUNK-у, а уже на самом телефоне происходит перевод в режим ACCES.

![image](https://github.com/DowningSun/OTUS/assets/156109695/b7a7e996-750d-41b4-8265-1168d2b3bb02)

Порты, ведущие к принтерам подключены к VLAN 40.

![image](https://github.com/DowningSun/OTUS/assets/156109695/47e380fb-c980-44f3-8279-cd83fac88432)

На всех коммутаторах уровня доступа доступны все VLAN, т.к. они соответствуют покабинетной схеме, и в случае изменения назначения кабинета перенастраивать придётся только порты на соответствующий VLAN, не изменяя настройку TRUNK портов.

В противном случае на коммутаторах были бы настроены только VLAN соответствующего подразделения, VLAN 60 для доступа в DMZ, VLAN 40 для принтеров и VLAN 70 для IP-телефонии. 

Все незанятые целевыми VLAN порты переведены в VLAN 60 для обеспечения гостевого подключения по условию заказчика.

**Настройка маршрутизаторов**

Для доступа к провайдерам используется 2 физических маршрутизатора, на которых настроен HSRP. Провайдер 1 имеет приоритет основного провайдера. Провайдер 2 - резервный.

Внутренняя настройка Маршрутизатора 1 имеет вид

![image](https://github.com/DowningSun/OTUS/assets/156109695/9d25f30d-e4dd-42df-bd05-047a9c9a17d0)

Прописан адрес устройства 11.11.11.1 и адрес виртуального роутера 11.11.11.3. Включен нат, который нам пригодится для симуляции доступа в интернет. 

Также для симуляции доступа винтернет включен OSPF  с маской, соответствующей внешнему адресу устройства (адрес полученный от провайдера)

![image](https://github.com/DowningSun/OTUS/assets/156109695/34be3f77-0dd8-481f-8fa1-9a9e4e54cd0c)

Настроена статическая маршрутизация во внутренние VLAN и "шлюз последний надежды", ведущий на маршрутизатор провайдера 2 для перенаправления трафика в случае перебоев со связью у провайдера 1.

![image](https://github.com/DowningSun/OTUS/assets/156109695/ce444037-8371-4c27-bddc-c9d278a90dc8)

Маршрутизатор провайдера 2 имеет внутренний адрес 11.11.11.2 и на нем натроен виртуальный роутер с адресом 11.11.11.3

![image](https://github.com/DowningSun/OTUS/assets/156109695/08170f9b-0c38-46aa-88f8-5e56c249856f)

Аналогично с настройками провайдера 1 настроена статическая маршрутизация во внутренние VLAN. Для симуляции доступа к сети интернет поднят NAT и OSPF.

![image](https://github.com/DowningSun/OTUS/assets/156109695/a96662e7-e8d1-48b1-9229-ea44bf3f799c)

На маршрутизаторах, симулирующих оборудование (provaider1 и provaider2) провайдеров запущен OSFP с адресной маской 0.0.0.0 255.255.255.255 для упрощения.

![image](https://github.com/DowningSun/OTUS/assets/156109695/f5ea477c-766a-46f1-bf80-4ea29e3b9d17)

В качестве сайта для проверки досупа в интернет выступает сервер INTERNET, на котором запущены службы HTTP\HTTPS, и настроен статический адрес 8.8.8.8














