#### Лабораторная работа - Конфигурация безопасности коммутатора 

Топология

![image](https://github.com/DowningSun/OTUS/assets/156109695/ace2cf4e-1750-4e8a-99f0-6aae30273039)

Таблица адресации

| Устройство | interface/vlan | IP-адрес | Маска подсети |
| ------ | ------ | ------ |  ------ |
| R1 | G0/0/1 | 192.168.10.1 | 255.255.255.0 |
| | Loopback 0 | 10.10.1.1 | 255.255.255.0 |
| S1 | VLAN 10 | 192.168.10.201 | 255.255.255.0 |
| S2 | VLAN 10 | 192.168.10.202 | 255.255.255.0 |
| PC A | NIC | DHCP | 255.255.255.0 |
| PC B | NIC | DHCP | 255.255.255.0 |

#### Выполнение работы

### Часть 1.Настройка основного сетевого устройства.

**Шаг 1. Создайте сеть.**
             
a. Создайте сеть согласно топологии.

**Шаг 2. Настройте маршрутизатор R1.**

a. Загрузите следующий конфигурационный скрипт на R1.

enable
configure terminal
hostname R1
no ip domain lookup
ip dhcp excluded-address 192.168.10.1 192.168.10.9
ip dhcp excluded-address 192.168.10.201 192.168.10.202
!
ip dhcp pool Students
 network 192.168.10.0 255.255.255.0
 default-router 192.168.10.1
 domain-name CCNA2.Lab-11.6.1
!
interface Loopback0
 ip address 10.10.1.1 255.255.255.0
!
interface GigabitEthernet0/0/1
 description Link to S1
 ip dhcp relay information trusted     Данная команда не поддерживается CPT
 ip address 192.168.10.1 255.255.255.0     
 no shutdown
!
line con 0
 logging synchronous
 exec-timeout 0 0

b. Проверьте текущую конфигурацию на R1, используя следующую команду:

R1# show ip interface brief

c. Убедитесь, что IP-адресация и интерфейсы находятся в состоянии up / up (при необходимости устраните неполадки).

![R1 sh int br](https://github.com/DowningSun/OTUS/assets/156109695/344525b2-b359-45f4-b564-5350ccaacd63)


**Шаг 3. Настройка и проверка основных параметров коммутатора**

a. Настройте имя хоста для коммутаторов S1 и S2.

b. Запретите нежелательный поиск в DNS.

c. Настройте описания интерфейса для портов, которые используются в S1 и S2.

d. Установите для шлюза по умолчанию для VLAN управления значение 192.168.10.1 на обоих коммутаторах.

![SW config](https://github.com/DowningSun/OTUS/assets/156109695/81aa3de0-3efb-4b57-b6a5-f83fb802bab1)


## Часть 2. Настройка сетей VLAN на коммутаторах.

**Шаг 1. Сконфигруриуйте VLAN 10.**

Добавьте VLAN 10 на S1 и S2 и назовите VLAN - Management.

**Шаг 2. Сконфигруриуйте SVI для VLAN 10.**

Настройте IP-адрес в соответствии с таблицей адресации для SVI для VLAN 10 на S1 и S2. Включите интерфейсы SVI и предоставьте описание для интерфейса.

**Шаг 3. Настройте VLAN 333 с именем Native на S1 и S2.**

**Шаг 4. Настройте VLAN 999 с именем ParkingLot на S1 и S2.**

## Часть 3. Настройки безопасности коммутатора.

**Шаг 1. Релизация магистральных соединений 802.1Q.**

Настройте все магистральные порты Fa0/1 на обоих коммутаторах для использования VLAN 333 в качестве native VLAN.

**Убедитесь, что режим транкинга успешно настроен на всех коммутаторах.**

**Отключить согласование DTP F0/1 на S1 и S2.**

**Проверьте с помощью команды show interfaces.**

![sh noneg](https://github.com/DowningSun/OTUS/assets/156109695/f4861107-b448-41cc-a731-6ea650a278b8)


**Шаг 2. Настройка портов доступа**

a. На S1 настройте F0/5 и F0/6 в качестве портов доступа и свяжите их с VLAN 10.

b. На S2 настройте порт доступа Fa0/18 и свяжите его с VLAN 10.

**Шаг 3. Безопасность неиспользуемых портов коммутатора**

a. На S1 и S2 переместите неиспользуемые порты из VLAN 1 в VLAN 999 и отключите неиспользуемые порты.

b. Убедитесь, что неиспользуемые порты отключены и связаны с VLAN 999, введя команду  show.

**Шаг 3. Безопасность неиспользуемых портов коммутатора**

a. На S1 и S2 переместите неиспользуемые порты из VLAN 1 в VLAN 999 и отключите неиспользуемые порты.

b. Убедитесь, что неиспользуемые порты отключены и связаны с VLAN 999, введя команду  show.

![sh int sta](https://github.com/DowningSun/OTUS/assets/156109695/9a5a2b8a-8d72-4c53-9c45-7cbfd4a4b87c)

**Шаг 4. Документирование и реализация функций безопасности порта.**

a. На S1, введите команду show port-security interface f0/6  для отображения настроек по умолчанию безопасности порта для интерфейса F0/6. Запишите свои ответы ниже.

| Конфигурация безопасности порта по умолчанию | |
| ------ | ------ |
| Защита портов | Disabled |
| Максимальное количество записей MAC-адресов | 1 |
| Режим проверки на нарушение безопасности | Shutdown |
| Aging Time | 0 mins |
| Aging Type | Absolute |
| Secure Static Address Aging | Disabled |
| Sticky MAC Address | 0 |

b. На S1 включите защиту порта на F0 / 6 со следующими настройками:
    
    • Максимальное количество записей MAC-адресов: 3
    • Режим безопасности: restrict
    • Aging time: 60 мин.
    • Aging type: неактивный

![S1F06 prot](https://github.com/DowningSun/OTUS/assets/156109695/78285eb3-d7ff-4ae8-94b3-02f17f7f0a8f)

**Из-за ограничений CPT настройкка switchport port-security aging-type inactivity недоступна.**
sw port-security aging ?
  time  Port-security aging time

c. Проверьте настройку на S1 F0/6.

![S1F06 verified](https://github.com/DowningSun/OTUS/assets/156109695/4b8e7857-3d19-4b89-898b-61eaa3158b20)


d. Включите безопасность порта для F0 / 18 на S2. Настройте каждый активный порт доступа таким образом, чтобы он автоматически добавлял адреса МАС, изученные на этом порту, в текущую конфигурацию.

e. Настройте следующие параметры безопасности порта на S2 F / 18:

    • Максимальное количество записей MAC-адресов: 2
    • Тип безопасности: Protect
    • Aging time: 60 мин.

f. Проверка функции безопасности портов на S2 F0/18.

![S2F018 verified](https://github.com/DowningSun/OTUS/assets/156109695/1b0e6112-2e00-49fc-a4bb-1161374f9211)


**Шаг 5. Реализовать безопасность DHCP snooping.**

a. На S2 включите DHCP snooping и настройте DHCP snooping во VLAN 10.

b. Настройте магистральные порты на S2 как доверенные порты.

c. Ограничьте ненадежный порт Fa0/18 на S2 пятью DHCP-пакетами в секунду.

d. Проверка DHCP Snooping на S2.

![S2dhcp snoop](https://github.com/DowningSun/OTUS/assets/156109695/05041c64-a054-4ed8-b757-70ab5e041df2)

e. В командной строке на PC-B освободите, а затем обновите IP-адрес.

C:\Users\Student> ipconfig /release
C:\Users\Student> ipconfig /renew

f. Проверьте привязку отслеживания DHCP с помощью команды show ip dhcp snooping binding.

![S2release](https://github.com/DowningSun/OTUS/assets/156109695/855fcd28-286f-4a96-b6bd-fa0a9d5eb825)

**Шаг 6. Реализация PortFast и BPDU Guard**

a. Настройте PortFast на всех портах доступа, которые используются на обоих коммутаторах.

b. Включите защиту BPDU на портах доступа VLAN 10 S1 и S2, подключенных к PC-A и PC-B.

c. Убедитесь, что защита BPDU и PortFast включены на соответствующих портах.

![S1portfast](https://github.com/DowningSun/OTUS/assets/156109695/4af13168-f0f8-4b02-ab86-0090bea00456)


**Шаг 7. Проверьте наличие сквозного ⁪подключения.**

Проверьте PING свзяь между всеми устройствами в таблице IP-адресации. В случае сбоя проверки связи может потребоваться отключить брандмауэр на хостах.

![pingtest](https://github.com/DowningSun/OTUS/assets/156109695/ff3efd41-8fbb-4e20-979f-44357706d33f)

**Вопросы для повторения**

1. С точки зрения безопасности порта на S2, почему нет значения таймера для оставшегося возраста в минутах, когда было сконфигурировано динамическое обучение - sticky?

2. Что касается безопасности порта на S2, если вы загружаете скрипт текущей конфигурации на S2, почему порту 18 на PC-B никогда не получит IP-адрес через DHCP?

3. Что касается безопасности порта, в чем разница между типом абсолютного устаревания и типом устаревание по неактивности?
